<!DOCTYPE html>
<html ng-app="textPlugin">
<head lang="en">
    <meta charset="UTF-8">

	<!-- CSS -->
    <link href="../../../../styles/helper.css" rel="stylesheet">
    <link href="../../../../styles/siteIcons.css" rel="stylesheet">

	<!-- JS -->
    <script src="../../../../scripts/buildfire.js"></script>
    <script src="../../../../scripts/angular/angular.min.js"></script>
    <script src="../../../../scripts/angular/ui-bootstrap.min.js"></script>

</head>
<body ng-controller="textPluginCtrl">
	<div ng-form="frmMain">
		<div class="item row clearfix">
			<div class="labels col-md-3 pull-left">
				<span>Background Image URL</span>
			</div>
			<div class="main col-md-9 pull-right">
				<input type="url" class="form-control" ng-model="data.content.bgURL"/>
		    </div>
		</div>
		<hr>
		<div class="item row clearfix">
			<div class="labels col-md-3 pull-left">
				<span>Text</span>
			</div>
			<div class="main col-md-9 pull-right">
				<textarea id="text" class="form-control" rows="5" width="100%" ng-model="data.content.text" ></textarea>
		    </div>
		</div>
		<hr>
		<div class="item row clearfix">
			<div class="labels col-md-3 pull-left">
				<span>Input and Button</span>
			</div>
			<div class="main col-md-9 pull-right row padding-left-zero">
				<div class="pull-left col-md-8 padding-zero">
					<input type="text" class="form-control" placeholder="Input"/>
				</div>
				<div class="col-md-4 pull-right">
					<a class="btn btn-primary pull-right stretch">Button</a>
				</div>
		    </div>
		</div>
		<hr>
		<div class="item row clearfix">
			<div class="labels col-md-3 pull-left">
				<span>Icons</span>
			</div>
			<div class="main col-md-9 pull-right row padding-left-zero">
				<span class="caret"></span>
				<span class="glyphicon glyphicon-plus"></span>
		    </div>
		</div>		
		<hr>
		<div class="item row clearfix">
			<div class="labels col-md-3 pull-left">
				<span>Dropdown</span>
			</div>
			<div class="main col-md-9 pull-right">
				<div class="dropdown" dropdown>
					<button class="btn btn-default text-left dropdown-toggle" data-toggle="dropdown" dropdown-toggle aria-expanded="true">
						<span class="pull-left">Dropdown</span>
				  		<span class="chevron icon-chevron-down pull-right"></span>
					</button>					
					<ul class="dropdown-menu extended" role="menu">
		                <li>
		                    <a class="transition-third">Item</a>
		                </li>
						<li>
		                    <a class="transition-third">Item</a>
		                </li>
						<li>
		                    <a class="transition-third">Item</a>
		                </li>
		            </ul>
				</div>
		    </div>
		</div>
	</div>	
<script>
    var textPluginApp = angular.module('textPlugin', ['ui.bootstrap']);

    textPluginApp.controller('textPluginCtrl',['$scope',function($scope){
        /*
        * Go pull any previously saved data
        * */
        buildfire.datastore.get(function (err, result) {
            if(result) {
                $scope.data= result.data;
                $scope.$digest();
                if (tmrDelay)clearTimeout(tmrDelay);
            }
        });

        /*
        * Call the datastore to save the data object
        */
        var saveData = function(newObj){

            if(newObj == undefined)return;
            if($scope.frmMain.$invalid ){
                console.warn('invalid data, no save');
                return;
            }

            buildfire.datastore.save(newObj, function (err, result) {
                if (err || !result)
                    alert(err);
                else
                    console.log('data saved');
            });
        };

        /*
        * create an artificial delay so api isnt called on every character entered
        * */
        var tmrDelay = null;
        var saveDataWithDelay = function(newObj){
            if(tmrDelay)clearTimeout(tmrDelay);
            tmrDelay = setTimeout(function(){saveData(newObj);},500);
        };

        /*
        * watch for changes in data and trigger the saveDataWithDelay function on change
        * */
        $scope.$watch('data',saveDataWithDelay ,true);
    }]);
</script>
</body>
</html>
